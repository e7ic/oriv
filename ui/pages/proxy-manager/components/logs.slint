import { VerticalBox, HorizontalBox, ScrollView } from "std-widgets.slint";
import { Tag, Button } from "../../../components/index.slint";

component LogItem inherits Rectangle {
    in property <string> time;
    in property <string> method;
    in property <string> protocol;
    in property <string> url;
    in property <string> status;
    in property <color> status-color;
    height: 48px;
    background: white;
    
    // Bottom border
    Rectangle {
        height: 1px;
        width: 100%;
        background: #f3f4f6;
        y: parent.height - 1px;
    }

    HorizontalLayout {
        padding-left: 24px;
        padding-right: 24px;
        alignment: start;
        spacing: 16px;

        // Time
        Text {
            text: root.time;
            color: #6b7280;
            font-size: 13px;
            vertical-alignment: center;
            width: 80px;
        }

        // Method Badge
        Tag {
            text: root.method;
            y: (parent.height - self.height) / 2;
        }

        // Protocol Badge
        Tag {
            text: root.protocol;
            base-color: root.protocol == "HTTPS" ? #111827 : #e5e7eb;
            text-color: root.protocol == "HTTPS" ? white : #374151;
            y: (parent.height - self.height) / 2;
        }

        // URL
        Text {
            text: root.url;
            color: #374151;
            font-size: 13px;
            vertical-alignment: center;
            overflow: elide;
            horizontal-stretch: 1;
        }

        // Status Badge
        Tag {
            text: root.status;
            base-color: root.status-color;
            text-color: white;
            y: (parent.height - self.height) / 2;
        }
    }
}

export struct LogEntry {
    time: string,
    method: string,
    protocol: string,
    url: string,
    status: string,
    status-code: int,
}

export component RequestLogs inherits VerticalLayout {
    spacing: 24px;
    in property <[LogEntry]> logs;
    callback clear-logs();

    // Header
    VerticalLayout {
        spacing: 16px;
        vertical-stretch: 0; // Don't stretch header
        Text {
            text: "请求日志";
            font-size: 16px;
            font-weight: 600;
            color: #111827;
        }

        HorizontalLayout {
            alignment: space-between;
            Text {
                text: "实时代理请求监控";
                color: #6b7280;
                font-size: 14px;
                vertical-alignment: center;
            }

            // Clear Button
            Button {
                text: "清空日志";
                outline: true;
                height: 32px;
                clicked => {
                    root.clear-logs();
                }
            }
        }
    }

    // Logs List
    Rectangle {
        vertical-stretch: 1; // Fill remaining space
        background: white;
        border-radius: 12px;
        border-width: 1px;
        border-color: #e5e7eb;
        clip: true;
        ScrollView {
            visible: root.logs.length > 0;
            viewport-height: (root.logs.length * 48px) + 32px;
            VerticalLayout {
                padding-top: 16px;
                padding-bottom: 16px;
                alignment: start;
                for log in root.logs: LogItem {
                    time: log.time;
                    method: log.method;
                    protocol: log.protocol;
                    url: log.url;
                    status: log.status;
                    status-color: log.status-code >= 400 ? #ef4444 : (log.status-code >= 300 ? #eab308 : #10b981);
                }
            }
        }

        if root.logs.length == 0 : VerticalLayout {
            alignment: center;
            spacing: 8px;
            
            Text {
                text: "暂无日志数据";
                font-size: 14px;
                color: #9ca3af;
                horizontal-alignment: center;
            }
            
            Text {
                text: "发起请求后将在此处显示";
                font-size: 12px;
                color: #d1d5db;
                horizontal-alignment: center;
            }
        }
    }
}
