import { VerticalBox, HorizontalBox, ScrollView } from "std-widgets.slint";
import { Button } from "../../../components/index.slint";

export struct HostEntry {
    address: string,
    hostnames: string,
}

export component HostsViewer inherits VerticalLayout {
    spacing: 24px;
    in property <[HostEntry]> hosts;
    callback refresh-hosts();

    VerticalLayout {
        spacing: 16px;
        vertical-stretch: 0;

        Text {
            text: "本机 Hosts";
            font-size: 16px;
            font-weight: 600;
            color: #111827;
        }

        HorizontalLayout {
            alignment: space-between;

            Text {
                text: "显示当前系统 hosts 文件中的有效映射";
                color: #6b7280;
                font-size: 14px;
                vertical-alignment: center;
            }

            Button {
                text: "刷新";
                outline: true;
                height: 32px;
                clicked => {
                    root.refresh-hosts();
                }
            }
        }
    }

    Rectangle {
        vertical-stretch: 1;
        background: white;
        border-radius: 12px;
        border-width: 1px;
        border-color: #e5e7eb;
        clip: true;

        ScrollView {
            visible: root.hosts.length > 0;

            VerticalLayout {
                padding: 16px;
                spacing: 0;

                for host in root.hosts: Rectangle {
                    height: 48px;
                    background: transparent;

                    HorizontalLayout {
                        x: 0;
                        y: 0;
                        width: 100%;
                        height: 100%;
                        spacing: 12px;
                        alignment: start;

                        Rectangle {
                            width: 160px;
                            height: 24px;
                            y: (parent.height - self.height) / 2;
                            border-radius: 4px;
                            background: #e5e7eb;

                            Text {
                                text: host.address;
                                color: #374151;
                                font-size: 12px;
                                font-weight: 600;
                                horizontal-alignment: center;
                                vertical-alignment: center;
                            }
                        }

                        Text {
                            text: host.hostnames;
                            color: #374151;
                            font-size: 13px;
                            vertical-alignment: center;
                            overflow: elide;
                            horizontal-stretch: 1;
                            y: (parent.height - self.height) / 2;
                        }
                    }

                    Rectangle {
                        height: 1px;
                        width: 100%;
                        background: #f3f4f6;
                        y: parent.height - 1px;
                    }
                }
            }
        }

        if root.hosts.length == 0 : VerticalLayout {
            alignment: center;
            spacing: 8px;

            Text {
                text: "未发现有效 hosts 记录";
                font-size: 14px;
                color: #9ca3af;
                horizontal-alignment: center;
            }

            Text {
                text: "请检查 hosts 文件是否存在并包含非注释条目";
                font-size: 12px;
                color: #d1d5db;
                horizontal-alignment: center;
            }
        }
    }
}
